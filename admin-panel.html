<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - mrc languages</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-button { transition: all 0.3s ease; }
        .tab-button.active { border-color: #4f46e5; background-color: #eef2ff; color: #4338ca; }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; }
        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-button:hover, .close-button:focus { color: black; text-decoration: none; }
        /* Basic styling for nested items */
        .unit-item { margin-left: 20px; border-left: 2px solid #ddd; padding-left: 10px; margin-top: 5px; }
        .lesson-item-admin { margin-left: 40px; padding-left: 10px; margin-top: 3px; font-size: 0.9em; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <header class="bg-indigo-700 text-white shadow-lg">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold">mrc languages - Admin Panel</h1>
            <button id="adminLogoutButton" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md text-sm">Logout</button>
        </div>
    </header>

    <main class="container mx-auto px-6 py-8">
        <div class="mb-6 border-b border-gray-300">
            <nav class="flex space-x-1" aria-label="Tabs">
                <button data-tab="users" class="tab-button active hs-tab-active:font-semibold hs-tab-active:border-blue-600 hs-tab-active:text-blue-600 py-3 px-4 inline-flex items-center gap-x-2 bg-transparent text-sm font-medium text-center border text-gray-500 rounded-t-lg hover:text-blue-600 disabled:opacity-50 disabled:pointer-events-none">Users</button>
                <button data-tab="languages" class="tab-button hs-tab-active:font-semibold hs-tab-active:border-blue-600 hs-tab-active:text-blue-600 py-3 px-4 inline-flex items-center gap-x-2 bg-transparent text-sm font-medium text-center border text-gray-500 rounded-t-lg hover:text-blue-600 disabled:opacity-50 disabled:pointer-events-none">Languages & Courses</button>
            </nav>
        </div>

        <div id="tabContent">
            <div id="users-tab" class="tab-pane active">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Registered Users</h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <p class="mb-4 text-lg">Total Users: <span id="userCount" class="font-bold text-indigo-600">0</span></p>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Full Name</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                </tr>
                            </thead>
                            <tbody id="userList" class="bg-white divide-y divide-gray-200">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="languages-tab" class="tab-pane hidden">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Manage Languages & Courses</h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <button id="addLanguageBtn" class="mb-6 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md">Add New Language</button>
                    <div id="languageListAdmin" class="space-y-4">
                        </div>
                </div>
            </div>
        </div>
    </main>

    <div id="addLanguageModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('addLanguageModal')">&times;</span>
            <h3 class="text-xl font-semibold mb-4">Add New Language</h3>
            <form id="addLanguageForm" class="space-y-4">
                <div>
                    <label for="langName" class="block text-sm font-medium">Language Name (e.g., Arabic):</label>
                    <input type="text" id="langName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label for="langCode" class="block text-sm font-medium">Code (e.g., ar):</label>
                    <input type="text" id="langCode" maxlength="2" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                 <div>
                    <label for="langIconColor" class="block text-sm font-medium">Icon Text Color (Tailwind class, e.g., text-purple-600):</label>
                    <input type="text" id="langIconColor" value="text-gray-700" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label for="langBgColor" class="block text-sm font-medium">Background Color (Tailwind class, e.g., bg-purple-100):</label>
                    <input type="text" id="langBgColor" value="bg-gray-100" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md">Save Language</button>
            </form>
        </div>
    </div>

    <div id="addUnitModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('addUnitModal')">&times;</span>
            <h3 class="text-xl font-semibold mb-4">Add New Unit to <span id="unitModalLangName"></span></h3>
            <form id="addUnitForm" class="space-y-4">
                <input type="hidden" id="unitLangIndex">
                <div>
                    <label for="unitTitle" class="block text-sm font-medium">Unit Title (e.g., Unit 1: Greetings):</label>
                    <input type="text" id="unitTitle" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md">Save Unit</button>
            </form>
        </div>
    </div>

    <div id="addLessonModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('addLessonModal')">&times;</span>
            <h3 class="text-xl font-semibold mb-4">Add New Lesson to <span id="lessonModalUnitName"></span></h3>
            <form id="addLessonForm" class="space-y-4">
                <input type="hidden" id="lessonLangIndex">
                <input type="hidden" id="lessonUnitIndex">
                <div>
                    <label for="lessonTitleAdmin" class="block text-sm font-medium">Lesson Title:</label>
                    <input type="text" id="lessonTitleAdmin" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label for="lessonContentAdmin" class="block text-sm font-medium">Lesson Content (HTML allowed):</label>
                    <textarea id="lessonContentAdmin" rows="5" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                </div>
                <div>
                    <label for="lessonImageUrl" class="block text-sm font-medium">Image URL (Optional):</label>
                    <input type="url" id="lessonImageUrl" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md">Save Lesson</button>
            </form>
        </div>
    </div>

    <script>
        // Admin Auth Check
        if (sessionStorage.getItem('isAdminLoggedIn') !== 'true') {
            window.location.href = 'admin-login.html';
        }

        const adminLogoutButton = document.getElementById('adminLogoutButton');
        adminLogoutButton.addEventListener('click', () => {
            sessionStorage.removeItem('isAdminLoggedIn');
            window.location.href = 'admin-login.html';
        });

        // Tab switching
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabPanes = document.querySelectorAll('.tab-pane');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                const tab = button.dataset.tab;
                tabPanes.forEach(pane => {
                    if (pane.id === `${tab}-tab`) {
                        pane.classList.remove('hidden');
                        pane.classList.add('active');
                    } else {
                        pane.classList.add('hidden');
                        pane.classList.remove('active');
                    }
                });
            });
        });
        
        // Modal functions
        function openModal(modalId) { document.getElementById(modalId).style.display = 'block'; }
        function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }

        // User Management
        const userCountEl = document.getElementById('userCount');
        const userListEl = document.getElementById('userList');

        function loadUsers() {
            const users = JSON.parse(localStorage.getItem('mrcUsers')) || [];
            userCountEl.textContent = users.length;
            userListEl.innerHTML = '';
            if (users.length === 0) {
                userListEl.innerHTML = '<tr><td colspan="2" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">No users found.</td></tr>';
            } else {
                users.forEach(user => {
                    const row = userListEl.insertRow();
                    row.insertCell().textContent = user.fullName;
                    row.insertCell().textContent = user.email;
                    row.cells[0].className = 'px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900';
                    row.cells[1].className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
                });
            }
        }

        // Language & Course Management
        const addLanguageBtn = document.getElementById('addLanguageBtn');
        const addLanguageModal = document.getElementById('addLanguageModal');
        const addLanguageForm = document.getElementById('addLanguageForm');
        const languageListAdminEl = document.getElementById('languageListAdmin');

        const addUnitModal = document.getElementById('addUnitModal');
        const addUnitForm = document.getElementById('addUnitForm');
        const unitModalLangName = document.getElementById('unitModalLangName');
        const unitLangIndexInput = document.getElementById('unitLangIndex');
        
        const addLessonModal = document.getElementById('addLessonModal');
        const addLessonForm = document.getElementById('addLessonForm');
        const lessonModalUnitName = document.getElementById('lessonModalUnitName');
        const lessonLangIndexInput = document.getElementById('lessonLangIndex');
        const lessonUnitIndexInput = document.getElementById('lessonUnitIndex');


        let mrcAdminCourses = JSON.parse(localStorage.getItem('mrcAdminCourses')) || [];

        addLanguageBtn.addEventListener('click', () => openModal('addLanguageModal'));
        addLanguageForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newLang = {
                name: document.getElementById('langName').value,
                code: document.getElementById('langCode').value.toLowerCase(),
                iconColor: document.getElementById('langIconColor').value,
                bgColor: document.getElementById('langBgColor').value,
                units: []
            };
            mrcAdminCourses.push(newLang);
            saveAndRenderCourses();
            closeModal('addLanguageModal');
            addLanguageForm.reset();
        });

        addUnitForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const langIndex = parseInt(unitLangIndexInput.value);
            const unitTitle = document.getElementById('unitTitle').value;
            if (mrcAdminCourses[langIndex]) {
                mrcAdminCourses[langIndex].units.push({ unitTitle: unitTitle, lessons: [] });
                saveAndRenderCourses();
            }
            closeModal('addUnitModal');
            addUnitForm.reset();
        });

        addLessonForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const langIndex = parseInt(lessonLangIndexInput.value);
            const unitIndex = parseInt(lessonUnitIndexInput.value);
            const lessonTitle = document.getElementById('lessonTitleAdmin').value;
            const lessonContent = document.getElementById('lessonContentAdmin').value;
            const lessonImageUrl = document.getElementById('lessonImageUrl').value;

            if (mrcAdminCourses[langIndex] && mrcAdminCourses[langIndex].units[unitIndex]) {
                mrcAdminCourses[langIndex].units[unitIndex].lessons.push({
                    title: lessonTitle,
                    content: lessonContent,
                    imageUrl: lessonImageUrl || null
                });
                saveAndRenderCourses();
            }
            closeModal('addLessonModal');
            addLessonForm.reset();
        });


        function saveAndRenderCourses() {
            localStorage.setItem('mrcAdminCourses', JSON.stringify(mrcAdminCourses));
            renderAdminCourseList();
        }

        function renderAdminCourseList() {
            languageListAdminEl.innerHTML = '';
            if (mrcAdminCourses.length === 0) {
                languageListAdminEl.innerHTML = '<p class="text-gray-500">No languages added yet.</p>';
                return;
            }
            mrcAdminCourses.forEach((lang, langIndex) => {
                const langDiv = document.createElement('div');
                langDiv.className = 'p-4 border rounded-md shadow-sm';
                let unitsHtml = '';
                if (lang.units && lang.units.length > 0) {
                    lang.units.forEach((unit, unitIndex) => {
                        let lessonsHtml = '';
                        if (unit.lessons && unit.lessons.length > 0) {
                            unit.lessons.forEach(lesson => {
                                lessonsHtml += `<div class="lesson-item-admin text-gray-600">${lesson.title} ${lesson.imageUrl ? '(has image)' : ''}</div>`;
                            });
                        } else {
                            lessonsHtml = '<div class="lesson-item-admin text-gray-400">No lessons in this unit.</div>';
                        }
                        unitsHtml += `
                            <div class="unit-item">
                                <div class="flex justify-between items-center">
                                    <h4 class="font-medium text-gray-700">${unit.unitTitle}</h4>
                                    <button class="add-lesson-btn text-xs bg-blue-500 hover:bg-blue-600 text-white py-1 px-2 rounded" data-lang-index="${langIndex}" data-unit-index="${unitIndex}">Add Lesson</button>
                                </div>
                                ${lessonsHtml}
                            </div>
                        `;
                    });
                } else {
                    unitsHtml = '<div class="unit-item text-gray-400">No units in this language.</div>';
                }

                langDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-lg font-semibold ${lang.iconColor}">${lang.name} (${lang.code.toUpperCase()})</h3>
                        <button class="add-unit-btn bg-green-500 hover:bg-green-600 text-white text-sm py-1 px-3 rounded" data-lang-index="${langIndex}" data-lang-name="${lang.name}">Add Unit</button>
                    </div>
                    ${unitsHtml}
                `;
                languageListAdminEl.appendChild(langDiv);
            });

            // Add event listeners for dynamically created buttons
            document.querySelectorAll('.add-unit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const langIndex = e.target.dataset.langIndex;
                    const langName = e.target.dataset.langName;
                    unitModalLangName.textContent = langName;
                    unitLangIndexInput.value = langIndex;
                    openModal('addUnitModal');
                });
            });
             document.querySelectorAll('.add-lesson-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const langIndex = e.target.dataset.langIndex;
                    const unitIndex = e.target.dataset.unitIndex;
                    const unitName = mrcAdminCourses[langIndex].units[unitIndex].unitTitle;
                    lessonModalUnitName.textContent = `${mrcAdminCourses[langIndex].name} - ${unitName}`;
                    lessonLangIndexInput.value = langIndex;
                    lessonUnitIndexInput.value = unitIndex;
                    openModal('addLessonModal');
                });
            });
        }

        // Initial Load
        loadUsers();
        renderAdminCourseList();
        // Set default tab to users
        document.querySelector('.tab-button[data-tab="users"]').click();

    </script>
</body>
</html>
